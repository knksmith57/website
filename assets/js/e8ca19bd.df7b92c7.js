"use strict";(self.webpackChunkcnoe=self.webpackChunkcnoe||[]).push([[5677],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>h});var a=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function n(e,t){if(null==e)return{};var r,a,i=function(e,t){if(null==e)return{};var r,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)r=l[a],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)r=l[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var d=a.createContext({}),c=function(e){var t=a.useContext(d),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},p=function(e){var t=c(e.components);return a.createElement(d.Provider,{value:t},e.children)},s="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},b=a.forwardRef((function(e,t){var r=e.components,i=e.mdxType,l=e.originalType,d=e.parentName,p=n(e,["components","mdxType","originalType","parentName"]),s=c(r),b=i,h=s["".concat(d,".").concat(b)]||s[b]||u[b]||l;return r?a.createElement(h,o(o({ref:t},p),{},{components:r})):a.createElement(h,o({ref:t},p))}));function h(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=r.length,o=new Array(l);o[0]=b;var n={};for(var d in t)hasOwnProperty.call(t,d)&&(n[d]=t[d]);n.originalType=e,n[s]="string"==typeof e?e:i,o[1]=n;for(var c=2;c<l;c++)o[c]=r[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,r)}b.displayName="MDXCreateElement"},664:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>n,toc:()=>c});var a=r(7462),i=(r(7294),r(3905));const l={sidebar_position:0,description:"IDP builder is a single binary IDP launcher.",title:"Architecture"},o=void 0,n={unversionedId:"reference-implementation/idpbuilder/architecture/architecture",id:"reference-implementation/idpbuilder/architecture/architecture",title:"Architecture",description:"IDP builder is a single binary IDP launcher.",source:"@site/docs/reference-implementation/idpbuilder/architecture/architecture.md",sourceDirName:"reference-implementation/idpbuilder/architecture",slug:"/reference-implementation/idpbuilder/architecture/",permalink:"/docs/reference-implementation/idpbuilder/architecture/",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/reference-implementation/idpbuilder/architecture/architecture.md",tags:[],version:"current",sidebarPosition:0,frontMatter:{sidebar_position:0,description:"IDP builder is a single binary IDP launcher.",title:"Architecture"},sidebar:"tutorialSidebar",previous:{title:"idpBuilder CLI",permalink:"/docs/reference-implementation/idpbuilder/"},next:{title:"Pluggability",permalink:"/docs/category/pluggability"}},d={},c=[{value:"Kind Cluster",id:"kind-cluster",level:3},{value:"Localbuild",id:"localbuild",level:3},{value:"GitServer",id:"gitserver",level:3},{value:"Embedded Argo Apps",id:"embedded-argo-apps",level:3},{value:"Diagram",id:"diagram",level:3}],p={toc:c},s="wrapper";function u(e){let{components:t,...l}=e;return(0,i.kt)(s,(0,a.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The idpBuilder binary is primarily composed of a wrapper around a ",(0,i.kt)("a",{parentName:"p",href:"https://kubebuilder.io"},"Kubebuilder")," based operator and associated type called localbuild. See: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/api/v1alpha1/localbuild_types.go#L28-L66"},"api/v1alpha1/localbuild_types.go")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/controllers/localbuild/controller.go#L54-L84"},"pkg/controllers/localbuild/controller.go")),(0,i.kt)("p",null,"However it starts out by creating a Kind cluster to register the CRD and controller for localbuild and to host the resources created by it which in turn create the basis for our IDP. You can see the steps taken to install the dependencies and stand up the localbuild controller in the CLI codebase here: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/build/build.go#L95-L131"},"pkg/build/build.go")),(0,i.kt)("h3",{id:"kind-cluster"},"Kind Cluster"),(0,i.kt)("p",null,"The Kind cluster is created using the Kind library and only requires Docker be installed on the host. See: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/build/build.go#L39-L59"},"ReconcileKindCluster")),(0,i.kt)("h3",{id:"localbuild"},"Localbuild"),(0,i.kt)("p",null,"Localbuild's reconciler steps through a number of subreconcilers to create all of the IDP components. See: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/controllers/localbuild/controller.go#L69-L74"},"Subreconcilers")),(0,i.kt)("p",null,"The subreconcilers currently include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/controllers/localbuild/controller.go#L102C32-L102C57"},"ReconcileProjectNamespace:")," Creates a namespace for the Localbuild objects"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/controllers/localbuild/argo.go#L51"},"ReconcileArgo:")," Installs ArgoCD"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/controllers/localbuild/controller.go#L125"},"ReconcileEmbeddedGitServer:"),' Installs a "gitserver" which is another Kubebuilder Operate in this project See: ',(0,i.kt)("a",{parentName:"li",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/api/v1alpha1/gitserver_types.go"},"api/v1alpha1/gitserver_types.go")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/controllers/localbuild/controller.go#L172"},"ReconcileArgoApps"),' Steps through all the "Embedded" Argo Apps and installs them. See: ',(0,i.kt)("a",{parentName:"li",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/apps/resources.go#L20-L32"},"Embedded Apps"))),(0,i.kt)("h3",{id:"gitserver"},"GitServer"),(0,i.kt)("p",null,"Gitserver is essentially a fileserver for the Argo apps that are packaged within this IDP builder. As you might expect, it serves the files used by the ArgoCD apps using the git protocol. You can see the container image that contains these files get built here in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/controllers/gitserver/image.go#L44-L60"},"GitServer Reconciler")),(0,i.kt)("h3",{id:"embedded-argo-apps"},"Embedded Argo Apps"),(0,i.kt)("p",null,"The embedded Argo apps are created by the Localbuild reconciler See: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/controllers/localbuild/controller.go#L210-L243"},"Argo Apps")," Then they are picked up by the ArgoCD operator which in turn connects to the GitServer to perform their gitops deployment."),(0,i.kt)("p",null,"The resources served by the GitServer are contained within this binary here: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/apps/srv/"},"pkg/apps/srv")),(0,i.kt)("p",null,"They include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/apps/srv/argocd/ingress.yaml"},"ArgoCD Ingress:")," which makes the ArgoCD interface available."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/apps/srv/backstage/install.yaml"},"Backstage:")," which intalls the Backstage Resources."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/apps/srv/crossplane/crossplane.yaml"},"Crossplane:")," which uses the Crossplane Helm chart to install Crossplane."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/cnoe-io/idpbuilder/blob/4b0f8ecdd7266083373da51d5add1bca73e05a33/pkg/apps/srv/nginx-ingress/ingress-nginx.yaml"},"Nginx Ingress Controller:")," which makes nginx ingresses available on the cluster.")),(0,i.kt)("p",null,"As you can imagine each of these apps are are deployed by ArgoCD to the Kind cluster created by CLI. The Argo apps can be inspected with kubectl in the ",(0,i.kt)("inlineCode",{parentName:"p"},"argocd")," namespace and the resources they create can be seen in their corresponding namespaces (",(0,i.kt)("inlineCode",{parentName:"p"},"backstage")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"crossplane"),")"),(0,i.kt)("h3",{id:"diagram"},"Diagram"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"diagram",src:r(2233).Z,width:"1036",height:"876"})))}u.isMDXComponent=!0},2233:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/idpbuilder-8dba8d8dd0ac17896072135d8dd0675a.png"}}]);